<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>権利処理・管理システム</title>

  <!-- ✅ キャッシュ対策：更新のたびに数字を変える -->
  <link rel="stylesheet" href="style.css?v=20260202-5">
</head>
<body>
  <header class="wrap">
    <h1>権利処理・管理システム</h1>
    <p class="sub">舞台創作の権利・倫理・安全を見える化する</p>
  </header>

  <main class="wrap grid">
    <!-- 左：ダッシュボード + テンプレ -->
    <section class="card">
      <h2>案件ダッシュボード</h2>

      <div class="dash">
        <div class="kpi">
          <div class="k">要確認</div>
          <div class="v" id="kpiNeeds">0</div>
        </div>
        <div class="kpi">
          <div class="k">対応中</div>
          <div class="v" id="kpiDoing">0</div>
        </div>
        <div class="kpi">
          <div class="k">完了</div>
          <div class="v" id="kpiDone">0</div>
        </div>
      </div>

      <div class="progressWrap">
        <div class="progressLabel">進捗（完了率）: <span id="progressPct">0%</span></div>
        <div class="progressBar">
          <div id="progressFill" class="progressFill" style="width:0%"></div>
        </div>
      </div>

      <hr />

      <h2>入力テンプレ（チェック式）</h2>
      <div class="grid2">
        <label class="check"><input type="checkbox" id="t_stream"> 配信あり（ライブ）</label>
        <label class="check"><input type="checkbox" id="t_archive"> アーカイブあり（後日公開）</label>
        <label class="check"><input type="checkbox" id="t_existing_music"> 既存曲を使う（BGM/歌）</label>
        <label class="check"><input type="checkbox" id="t_recorded_music"> 音源（録音）を流す</label>
        <label class="check"><input type="checkbox" id="t_minors"> 未成年出演あり</label>
        <label class="check"><input type="checkbox" id="t_backstage"> 舞台裏/楽屋を撮る可能性</label>
        <label class="check"><input type="checkbox" id="t_strobe"> ストロボ/点滅照明あり</label>
        <label class="check"><input type="checkbox" id="t_real_event"> 実在事件/災害が題材</label>
      </div>

      <label style="margin-top:10px;">撮影範囲（任意）</label>
      <input id="t_shoot_range" placeholder="例：客席は映さない、舞台上のみ、終演後の挨拶だけ など" />

      <div class="row">
        <button type="button" id="btnApplyTemplate">テンプレを入力欄に反映</button>
        <button type="button" class="ghost danger" id="btnResetTemplate">テンプレをリセット</button>
      </div>

      <div class="hint">※テンプレは抜け漏れ防止です。必要なら自由に追記してください。</div>
    </section>

    <!-- 右：入力→解析 -->
    <section class="card">
      <h2>① 台本 / 演出メモ（自由記述）</h2>
      <textarea id="inputText" placeholder="例：SNSで告知画像を使う。衣装は既製品を改造。舞台美術に有名キャラのロゴを入れたい。"></textarea>

      <div class="row">
        <button type="button" id="analyzeBtn">解析する</button>
        <button type="button" class="ghost danger" id="clearBtn">入力を消す</button>
      </div>

      <h3>② 抽出された論点（候補）</h3>
      <ul id="issuesList" class="issues"></ul>

      <details style="margin-top:12px;">
        <summary>不足情報の確認質問（ルール）</summary>
        <ul id="questionsList" class="bullets"></ul>
      </details>

      <details style="margin-top:10px;">
        <summary>対応案テンプレ（ルール）</summary>
        <ul id="actionsList" class="bullets"></ul>
      </details>

      <details style="margin-top:10px;">
        <summary>チェックリスト（自動生成 Tasks）</summary>
        <ul id="tasksList" class="bullets"></ul>
      </details>

      <hr style="margin-top:14px;" />

      <h3>③ 自由記述からのリスク候補（Webで根拠確認）</h3>
      <div class="hint">
        ※静的サイトでは他サイト本文を直接取得できないため、まず検索リンクを出します。<br>
        ※見つけたURLは「添付URLに反映」でログ欄の添付URLへ入ります。
      </div>

      <div id="webRisksList" class="webrisk"></div>
      <div id="webRisksError" class="errorBox" style="display:none;"></div>
    </section>

    <!-- 下：案件＋ログ -->
    <section class="card" style="grid-column:1/-1;">
      <h2>④ 案件（Project）</h2>

      <div class="row">
        <input id="projectTitle" class="grow" placeholder="案件名（例：本番公演A）" />
        <button type="button" id="createProjectBtn">作成</button>
      </div>

      <div class="row">
        <select id="projectSelect" class="grow"></select>
        <button type="button" class="ghost danger" id="deleteProjectBtn">案件削除</button>
      </div>

      <hr />

      <h2>⑤ ログ（合意形成ログ）</h2>

      <div class="filters">
        <div class="grid4">
          <div>
            <label>検索（論点/理由）</label>
            <input id="f_q" placeholder="キーワード" />
          </div>
          <div>
            <label>要素</label>
            <select id="f_element">
              <option value="">すべて</option>
              <option>脚本</option><option>演出</option><option>音楽</option><option>照明</option>
              <option>映像</option><option>全体</option>
            </select>
          </div>
          <div>
            <label>カテゴリ</label>
            <select id="f_category">
              <option value="">すべて</option>
              <option value="copyright">著作権</option>
              <option value="privacy">プライバシー</option>
              <option value="ethics">倫理</option>
              <option value="safety">安全</option>
              <option value="bias">偏り</option>
              <option value="art">美術</option>
              <option value="costume">衣装</option>
              <option value="sns">SNS</option>
            </select>
          </div>
          <div>
            <label>ステータス</label>
            <select id="f_status">
              <option value="">すべて</option>
              <option value="needs_review">要確認</option>
              <option value="doing">対応中</option>
              <option value="done">完了</option>
            </select>
          </div>
        </div>

        <div class="grid4" style="margin-top:10px;">
          <div style="grid-column:1/-1;">
            <label>期間（複数追加できます）</label>

            <div id="dateRows" class="dateRows">
              <div class="dateRow">
                <input class="f_from" type="date" />
                <span class="dateSep">〜</span>
                <input class="f_to" type="date" />
                <button type="button" class="ghost danger btnDelDate" title="この期間を削除">×</button>
              </div>
            </div>

            <div class="row" style="margin-top:10px;">
              <button type="button" class="success" id="btnAddDateRow">＋期間を追加</button>
              <button type="button" class="ghost danger" id="f_reset">フィルタ解除</button>
            </div>

            <div class="hint">※複数期間は「どれか1つでも一致（OR）」で絞り込みます。</div>

            <!-- 互換用（非表示） -->
            <input id="f_from" type="date" style="display:none" />
            <input id="f_to" type="date" style="display:none" />
          </div>
        </div>
      </div>

      <hr />

      <div class="grid2">
        <div>
          <label>要素</label>
          <select id="logElement">
            <option>脚本</option><option>演出</option><option>音楽</option><option>照明</option>
            <option>映像</option><option>全体</option>
          </select>
        </div>
        <div>
          <label>カテゴリ</label>
          <select id="logCategory">
            <option value="copyright">著作権</option>
            <option value="privacy">プライバシー</option>
            <option value="ethics">倫理</option>
            <option value="safety">安全</option>
            <option value="bias">偏り</option>
            <option value="art">美術</option>
            <option value="costume">衣装</option>
            <option value="sns">SNS</option>
          </select>
        </div>
      </div>

      <label style="margin-top:10px;">論点（issue）</label>
      <textarea id="logIssue" placeholder="例：SNS告知画像の素材出所（写真/フォント/ロゴ）を確認"></textarea>

      <div class="grid4" style="margin-top:10px;">
        <div>
          <label>判断</label>
          <select id="logDecision">
            <option>要確認</option>
            <option>採用</option>
            <option>却下</option>
            <option>保留</option>
          </select>
        </div>
        <div>
          <label>ステータス（進捗）</label>
          <select id="logStatus">
            <option value="needs_review">要確認</option>
            <option value="doing">対応中</option>
            <option value="done">完了</option>
          </select>
        </div>
        <div style="grid-column: span 2;">
          <label>理由（任意）</label>
          <input id="logRationale" placeholder="判断理由（責任ログ）" />
        </div>
      </div>

      <div class="grid2" style="margin-top:10px;">
        <div>
          <label>添付URL（任意：根拠URLなど）</label>
          <input id="logAttachUrl" placeholder="https://..." />
        </div>
        <div>
          <label>添付メモ（任意）</label>
          <input id="logAttachMemo" placeholder="例：引用要件の解説、SNS利用規約、素材ライセンス など" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <button type="button" class="success" id="addLogBtn">ログ追加</button>
        <button type="button" class="ghost danger" id="clearLogsBtn">ログ全削除</button>
      </div>

      <h3 style="margin-top:14px;">ログ一覧</h3>
      <div id="logsTable" class="table"></div>

      <div class="hint">※保存先はブラウザ内（LocalStorage）です。</div>
    </section>
  </main>

  <footer class="wrap foot">
    <small>© Stage Ethics Demo</small>
  </footer>

  <script src="app.js?v=20260202-5"></script>
</body>
</html>
