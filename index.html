<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stage Ethics & Rights (GitHub Pages)</title>
  <link rel="stylesheet" href="style.css?v=20260128" />
</head>
<body>
  <header class="wrap">
    <h1>Stage Ethics & Rights</h1>
    <p class="sub">GitHubだけで動く（静的）デモ：入力テンプレ→論点抽出→合意形成ログ→JSON書き出し</p>
  </header>

  <main class="wrap grid">
    <!-- ✅ ガイド + ダッシュボード -->
    <section class="card">
      <h2>0) 次にやること（ガイド）</h2>
      <ol class="steps">
        <li><b>案件を作成</b>（右の「③ 案件」）</li>
        <li><b>入力テンプレ</b>で条件をチェック（このカード下）</li>
        <li><b>解析する</b>で論点候補を出す</li>
        <li><b>論点をログへ</b>→人間が判断（要確認/対応中/完了）</li>
      </ol>

      <h2 style="margin-top:12px;">案件ダッシュボード</h2>
      <div class="dash">
        <div class="kpi"><div class="k">要確認</div><div class="v" id="kpiNeeds">0</div></div>
        <div class="kpi"><div class="k">対応中</div><div class="v" id="kpiDoing">0</div></div>
        <div class="kpi"><div class="k">完了</div><div class="v" id="kpiDone">0</div></div>
      </div>

      <div class="progressWrap">
        <div class="progressLabel">進捗（完了率）: <span id="progressPct">0%</span></div>
        <div class="progressBar"><div id="progressFill" class="progressFill" style="width:0%"></div></div>
      </div>

      <hr />

      <h2>入力テンプレ（チェック式）</h2>
      <div class="grid2">
        <label class="check"><input type="checkbox" id="t_stream"> 配信あり（ライブ）</label>
        <label class="check"><input type="checkbox" id="t_archive"> アーカイブあり（後日公開）</label>
        <label class="check"><input type="checkbox" id="t_existing_music"> 既存曲を使う（BGM/歌）</label>
        <label class="check"><input type="checkbox" id="t_recorded_music"> 音源（録音）を流す</label>
        <label class="check"><input type="checkbox" id="t_minors"> 未成年出演あり</label>
        <label class="check"><input type="checkbox" id="t_backstage"> 舞台裏/楽屋を撮る可能性</label>
        <label class="check"><input type="checkbox" id="t_strobe"> ストロボ/点滅照明あり</label>
        <label class="check"><input type="checkbox" id="t_real_event"> 実在事件/災害が題材</label>
      </div>

      <label style="margin-top:10px;">撮影範囲（任意）</label>
      <input id="t_shoot_range" placeholder="例：客席は映さない、舞台上のみ、終演後の挨拶だけ など" />

      <div class="row">
        <button id="btnApplyTemplate">テンプレを入力欄に反映</button>
        <button class="ghost" id="btnResetTemplate">テンプレをリセット</button>
      </div>

      <div class="hint">
        ※テンプレは「入力の抜け漏れ防止」です。必要なら自由に追記してください。
      </div>
    </section>

    <!-- 入力→解析 -->
    <section class="card">
      <h2>① 台本 / 演出メモ（入力）</h2>
      <textarea id="inputText" placeholder="例：この公演は配信します。既存曲をBGMで使います。実在の事件を題材にします。"></textarea>

      <div class="row">
        <button id="analyzeBtn">解析する</button>
        <button class="ghost" id="clearBtn">入力を消す</button>
      </div>

      <h3>② 抽出された論点（候補）</h3>
      <ul id="issuesList" class="issues"></ul>

      <details style="margin-top:12px;">
        <summary>不足情報の確認質問（AI補助：ルール）</summary>
        <ul id="questionsList" class="bullets"></ul>
      </details>

      <details style="margin-top:10px;">
        <summary>対応案テンプレ（AI補助：ルール）</summary>
        <ul id="actionsList" class="bullets"></ul>
      </details>

      <details style="margin-top:10px;">
        <summary>チェックリスト（自動生成 Tasks）</summary>
        <ul id="tasksList" class="bullets"></ul>
      </details>

      <div class="hint">
        ※AIではなく「ルールベース」で材料を出します。後からLLMに差し替え可能。
      </div>
    </section>

    <!-- 案件＋ログ -->
    <section class="card" style="grid-column:1/-1;">
      <h2>③ 案件（Project）</h2>

      <div class="row">
        <input id="projectTitle" class="grow" placeholder="案件名（例：本番公演A）" />
        <button id="createProjectBtn">作成</button>
      </div>

      <div class="row">
        <select id="projectSelect" class="grow"></select>
        <button class="ghost" id="deleteProjectBtn">案件削除</button>
        <button class="ghost" id="exportAllBtn">全体JSON書き出し</button>
      </div>

      <hr />

      <h2>④ ログ（合意形成ログ）</h2>

      <!-- ✅ フィルタ -->
      <div class="filters">
        <div class="grid4">
          <div>
            <label>検索（論点/理由）</label>
            <input id="f_q" placeholder="キーワード" />
          </div>
          <div>
            <label>要素</label>
            <select id="f_element">
              <option value="">すべて</option>
              <option>脚本</option><option>演出</option><option>音楽</option><option>照明</option>
              <option>美術</option><option>衣装</option><option>映像</option><option>SNS</option><option>全体</option>
            </select>
          </div>
          <div>
            <label>カテゴリ</label>
            <select id="f_category">
              <option value="">すべて</option>
              <option value="copyright">copyright</option>
              <option value="privacy">privacy</option>
              <option value="ethics">ethics</option>
              <option value="safety">safety</option>
              <option value="bias">bias</option>
            </select>
          </div>
          <div>
            <label>ステータス</label>
            <select id="f_status">
              <option value="">すべて</option>
              <option value="needs_review">要確認</option>
              <option value="doing">対応中</option>
              <option value="done">完了</option>
            </select>
          </div>
        </div>

        <div class="grid4" style="margin-top:10px;">
          <div>
            <label>期間（開始）</label>
            <input id="f_from" type="date" />
          </div>
          <div>
            <label>期間（終了）</label>
            <input id="f_to" type="date" />
          </div>
          <div class="row" style="align-items:end;">
            <button class="ghost" id="f_reset">フィルタ解除</button>
          </div>
        </div>
      </div>

      <hr />

      <!-- 追加フォーム -->
      <div class="grid2">
        <div>
          <label>要素</label>
          <select id="logElement">
            <option>脚本</option><option>演出</option><option>音楽</option><option>照明</option>
            <option>美術</option><option>衣装</option><option>映像</option><option>SNS</option><option>全体</option>
          </select>
        </div>
        <div>
          <label>カテゴリ</label>
          <select id="logCategory">
            <option value="copyright">copyright</option>
            <option value="privacy">privacy</option>
            <option value="ethics">ethics</option>
            <option value="safety">safety</option>
            <option value="bias">bias</option>
          </select>
        </div>
      </div>

      <label style="margin-top:10px;">論点（issue）</label>
      <textarea id="logIssue" placeholder="例：配信/収録の権利範囲を上演と分けて確認する"></textarea>

      <div class="grid4" style="margin-top:10px;">
        <div>
          <label>判断</label>
          <select id="logDecision">
            <option>要確認</option>
            <option>採用</option>
            <option>却下</option>
            <option>保留</option>
          </select>
        </div>
        <div>
          <label>ステータス（進捗）</label>
          <select id="logStatus">
            <option value="needs_review">要確認</option>
            <option value="doing">対応中</option>
            <option value="done">完了</option>
          </select>
        </div>
        <div style="grid-column: span 2;">
          <label>理由（任意）</label>
          <input id="logRationale" placeholder="判断理由（責任ログ）" />
        </div>
      </div>

      <!-- ✅ 添付 -->
      <div class="grid2" style="margin-top:10px;">
        <div>
          <label>添付URL（任意：同意書/資料リンク）</label>
          <input id="logAttachUrl" placeholder="https://..." />
        </div>
        <div>
          <label>添付メモ（任意）</label>
          <input id="logAttachMemo" placeholder="例：出演者同意書PDF、JASRAC申請控え など" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="addLogBtn">ログ追加</button>
        <button class="ghost" id="exportBtn">JSON書き出し（この案件）</button>
        <button class="ghost" id="clearLogsBtn">ログ全削除</button>
      </div>

      <h3 style="margin-top:14px;">ログ一覧</h3>
      <div id="logsTable" class="table"></div>

      <div class="hint">
        ※保存先はブラウザ内（LocalStorage）です。別PC・別ブラウザでは共有されません。
      </div>
    </section>
  </main>

  <footer class="wrap foot">
    <small>© Stage Ethics Demo / GitHub Pages only</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
