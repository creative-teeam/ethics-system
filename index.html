<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>権利処理・管理システム</title>
  <link rel="stylesheet" href="style.css?v=20260202-8">
</head>
<body>
  <header class="wrap">
    <h1>権利処理・管理システム</h1>
    <p class="sub">舞台創作の権利・倫理・安全を見える化する</p>
  </header>

  <main class="wrap grid">
    <!-- 左：ダッシュボード + テンプレ -->
    <section class="card">
      <h2>案件ダッシュボード</h2>

      <div class="dash">
        <div class="kpi">
          <div class="k">要確認</div>
          <div class="v" id="kpiNeeds">0</div>
        </div>
        <div class="kpi">
          <div class="k">対応中</div>
          <div class="v" id="kpiDoing">0</div>
        </div>
        <div class="kpi">
          <div class="k">完了</div>
          <div class="v" id="kpiDone">0</div>
        </div>
      </div>

      <div class="progressWrap">
        <div class="progressLabel">進捗（完了率）: <span id="progressPct">0%</span></div>
        <div class="progressBar">
          <div id="progressFill" class="progressFill" style="width:0%"></div>
        </div>
      </div>

      <hr />

      <h2>入力テンプレ（チェック式）</h2>
      <div class="grid2">
        <label class="check"><input type="checkbox" id="t_stream"> 配信あり（ライブ）</label>
        <label class="check"><input type="checkbox" id="t_archive"> アーカイブあり（後日公開）</label>
        <label class="check"><input type="checkbox" id="t_existing_music"> 既存曲を使う（BGM/歌）</label>
        <label class="check"><input type="checkbox" id="t_recorded_music"> 音源（録音）を流す</label>
        <label class="check"><input type="checkbox" id="t_minors"> 未成年出演あり</label>
        <label class="check"><input type="checkbox" id="t_backstage"> 舞台裏/楽屋を撮る可能性</label>
        <label class="check"><input type="checkbox" id="t_strobe"> ストロボ/点滅照明あり</label>
        <label class="check"><input type="checkbox" id="t_real_event"> 実在事件/災害が題材</label>
      </div>

      <div class="row">
        <button type="button" id="btnApplyTemplate">テンプレを入力欄に反映</button>
        <button type="button" class="ghost danger" id="btnResetTemplate">テンプレをリセット</button>
      </div>

      <div class="hint">※テンプレは抜け漏れ防止です。必要なら自由記述に追記してください。</div>
    </section>

    <!-- 右：入力→解析 + 根拠確認 -->
    <section class="card">
      <h2>① 台本 / 演出メモ（自由記述）</h2>
      <textarea id="inputText" placeholder="例：SNSで告知画像を使う。衣装は既製品を改造。舞台美術に有名キャラのロゴを入れたい。演出メモ：客席の映り込みは避ける。"></textarea>

      <div class="row">
        <button type="button" id="analyzeBtn">解析する</button>
        <button type="button" class="ghost danger" id="clearBtn">入力を消す</button>
      </div>

      <h3>② 抽出された論点（候補）</h3>
      <ul id="issuesList" class="issues"></ul>

      <details style="margin-top:12px;">
        <summary>不足情報の確認質問（ルール）</summary>
        <ul id="questionsList" class="bullets"></ul>
      </details>

      <details style="margin-top:10px;">
        <summary>対応案テンプレ（ルール）</summary>
        <ul id="actionsList" class="bullets"></ul>
      </details>

      <details style="margin-top:10px;">
        <summary>チェックリスト（自動生成 Tasks）</summary>
        <ul id="tasksList" class="bullets"></ul>
      </details>

      <hr style="margin-top:14px;" />

      <h3>③ 根拠確認（Web検索リンク）</h3>
      <div class="hint">
        ※静的サイトでは他サイト本文を直接取得できないため、検索リンクを提示します。<br>
        ※自由記述（台本/演出メモ）を入力すると自動で候補が更新されます。<br>
        ※「添付URLに反映」でログ欄の添付URLへ入ります。
      </div>

      <div class="webSearchBox">
        <label>追加で検索したいキーワード（任意）</label>
        <div class="row">
          <input id="webQuery" class="grow" placeholder="例：舞台 配信 公衆送信権 / 衣装 ロゴ 商標 / SNS 告知 フォント 著作権" />
          <button type="button" class="success" id="btnWebSearch">検索リンクを追加</button>
        </div>
        <div class="hint">※ここで追加した検索も、根拠確認リストに追加されます。</div>
      </div>

      <div id="webRisksList" class="webrisk"></div>
      <div id="webRisksError" class="errorBox" style="display:none;"></div>
    </section>

    <!-- 下：案件＋ログ -->
    <section class="card" style="grid-column:1/-1;">
      <h2>④ 案件（Project）</h2>

      <div class="row">
        <input id="projectTitle" class="grow" placeholder="案件名（例：本番公演A）" />
        <button type="button" id="createProjectBtn">作成</button>
      </div>

      <div class="row">
        <select id="projectSelect" class="grow"></select>
        <button type="button" class="ghost danger" id="deleteProjectBtn">案件削除</button>
      </div>

      <hr />

      <h2>⑤ 合意形成ログ</h2>

      <!-- ✅ ⑤：検索＋共通設定（要素/カテゴリ/ステータスはここ1つだけ） -->
      <div class="filters">
        <div class="grid4">
          <div>
            <label>検索（論点/理由/添付）</label>
            <input id="f_q" placeholder="キーワード" />
          </div>

          <div>
            <label>要素（ログ）</label>
            <select id="logElement">
              <option>脚本</option><option>演出</option><option>音楽</option><option>照明</option>
              <option>美術</option><option>衣装</option><option>映像</option><option>SNS</option><option>全体</option>
            </select>
          </div>

          <div>
            <label>カテゴリ（ログ）</label>
            <select id="logCategory">
              <option value="copyright">copyright</option>
              <option value="privacy">privacy</option>
              <option value="ethics">ethics</option>
              <option value="safety">safety</option>
              <option value="bias">bias</option>
            </select>
          </div>

          <div>
            <label>ステータス（ログ）</label>
            <select id="logStatus">
              <option value="needs_review">要確認</option>
              <option value="doing">対応中</option>
              <option value="done">完了</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px;">
          <label>期間（このログに保存／同時にフィルタにも使う・複数追加OK）</label>

          <div id="dateRows" class="dateRows">
            <div class="dateRow">
              <input class="f_from" type="date" />
              <span class="dateSep">〜</span>
              <input class="f_to" type="date" />
              <button type="button" class="ghost danger btnDelDate" title="この期間を削除">×</button>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <button type="button" class="success" id="btnAddDateRow">＋期間を追加</button>
            <button type="button" class="ghost danger" id="f_reset">フィルタ解除</button>
          </div>

          <div class="hint">※期間はログにも保存され、絞り込みにも使えます。</div>
        </div>
      </div>

      <hr />

      <label style="margin-top:10px;">論点（issue）</label>
      <textarea id="logIssue" placeholder="例：SNS告知画像の素材出所（写真/フォント/ロゴ）を確認"></textarea>

      <div class="grid4" style="margin-top:10px;">
        <div>
          <label>判断</label>
          <select id="logDecision">
            <option>要確認</option>
            <option>採用</option>
            <option>却下</option>
            <option>保留</option>
          </select>
        </div>
        <div style="grid-column: span 3;">
          <label>理由（任意）</label>
          <input id="logRationale" placeholder="判断理由（責任ログ）" />
        </div>
      </div>

      <div class="grid2" style="margin-top:10px;">
        <div>
          <label>添付URL（任意：根拠URLなど）</label>
          <input id="logAttachUrl" placeholder="https://..." />
        </div>
        <div>
          <label>添付メモ（任意）</label>
          <input id="logAttachMemo" placeholder="例：引用要件の解説、SNS利用規約、フォント利用条件 など" />
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <button type="button" class="success" id="addLogBtn">ログ追加</button>
        <button type="button" class="ghost danger" id="clearLogsBtn">ログ全削除</button>
      </div>

      <div id="logAddResult" class="hint" style="margin-top:8px;"></div>

      <h3 style="margin-top:14px;">ログ一覧</h3>
      <div id="logsTable" class="table"></div>

      <div class="hint">※保存先はブラウザ内（LocalStorage）です。</div>
    </section>
  </main>

  <footer class="wrap foot">
    <small>© Stage Ethics Demo</small>
  </footer>

  <script src="app.js?v=20260202-8"></script>
</body>
</html>
